<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>JSTMPL test</title>
<style>
    .red {
        color: red;
    }
</style>
<div id="app"></div>
<script>
(e=>{"use strict";const t=document,r="appendChild",n="setAttribute",f="createTextNode",o=(e,c,i)=>{const l=t.createElement(e),s=[];for(let e in c){let r=c[e];if("ev"!==e)if("function"!=typeof r)l[n](e,r);else{let f=t.createAttribute(e);s.push({f:r,n:f}),l[n+"Node"](f)}else for(let e in r)l.addEventListener(e,r[e])}const a=typeof i;"string"===a?l[r](t[f](i)):"function"===a?s.push({f:i,n:l[r](t[f](""))}):"object"===a&&i.forEach(e=>l[r](e.ref));const u=e=>{s.forEach(t=>{const r=t.n,f=t.f(e);t.old!==f&&("object"==typeof r?"INPUT"===l.tagName&&"value"===r.name&&l.value!==f?l.value=f:r.nodeValue=f:o.ref[n](r,f),t.old=f)}),Array.isArray(i)&&i.forEach(t=>t(e))};return u.ref=l,u},c=(e,t,n)=>{let f=!1;const o=o=>{e(o);const c=t(o);c&&n(o),f&&!c?(e.ref.removeChild(n.ref),f=!1):c&&(e.ref[r](n.ref),f=!0)};return o.ref=e.ref,o},i=(e,t,n)=>{let f=[],o=[],c=c=>{e(c);const i=t(c);i.forEach((t,i)=>{if(f[i]===t)return;const l={index:i,item:t,parent:c};if(o[i])return o[i](l);const s=n();s(l),o.push(s),e.ref[r](s.ref)});const l=f.length,s=i.length;if(l>s){let t=l-s;for(o.splice(s);t--;)e.ref.removeChild(e.ref.children[s])}f=i.slice()};return c.ref=e.ref,c};e&&(e.h=o,e.hIf=c,e.hFor=i)})(window);var Model={state:{clicks:0,error:"",className:"",show:!0,input:"",itemInputs:[1,2,3,4,5],items:[1,2,3,4,5]}};function main(){var e={clicks:0,error:"",className:"",show:!0,input:"",itemInputs:[],items:[]},t=e;function n(){console.log("loading model"),t=JSON.parse(window.localStorage.getItem("model"))||e,c()}function i(e){var n;console.log("removing item "+e.target.getAttribute("data-index")),t.items.splice(n=1*e.target.getAttribute("data-index"),1),t.itemInputs.splice(n),c()}function o(e){var n=e.target.getAttribute("data-index");t.itemInputs[n]=e.target.value}function a(e){var n=e.target.getAttribute("data-index");t.items[n]=t.itemInputs[n],t.itemInputs[n]="",c()}function s(){window.localStorage&&window.localStorage.setItem("model",JSON.stringify(t))}setTimeout(n,0);var u=!1;function d(e){return function(t){return t[e]}}window.addEventListener("hashchange",(function(){t.show=!t.show,console.log(t.show),c()})),window.addEventListener("storage",n);var r=h("div",{class:"ahoj"},[h("h1",{class:d("className"),ev:{click:function(e){t.className="red"===t.className?"":"red",c()}}},"Ahoj"),h("div",u,[h("p",u,d("clicks"))]),h("span",u,d("error")),h("a",{href:"#prdel",ev:{click:function(e){}}},"link1"),h("hr"),h("button",{ev:{mouseup:function(e){t.clicks++,t.clicks>0&&(t.error="",t.show=!0),c()}}},"   +   "),h("i",u," "),h("button",{ev:{mouseup:function(e){t.clicks--,t.clicks<0&&(t.error="Fok You!",t.show=!1),c()}}},"   -   "),hIf(h("h2",u,"Ahoj"),d("error"),h("span",u,d("error"))),hIf(h("div"),d("show"),h("div",u,[h("div",u,[h("div",u,[h("h1",u,"Ahoj")]),h("div",u,[h("h2",u,"Dalsi ahoj")])])])),hFor(h("ul"),d("items"),(function(){return h("li",u,[h("span",u,d("item")),h("span",u," "),h("input",{value:d("item"),"data-index":d("index"),ev:{change:o}}),h("button",{"data-index":d("index"),ev:{click:a}},"edit"),h("button",{"data-index":d("index"),ev:{mouseup:i}}," X ")])})),h("input",{value:d("input"),ev:{change:function(e){t.input=e.target.value}}}),h("button",{ev:{mouseup:function(e){t.items.push(t.input),t.itemInputs.push(t.input),t.input="",c()}}},"add Item")]);function c(e){setTimeout(s,0),"update"in r?r.update(e||t):r(e||t)}"update"in r?r.update(t):r(t);var l=document.getElementById("app");l.innerHTML="",l.appendChild(r.ref)}function route(e){console.log("hashchange")}window.addEventListener?window.addEventListener("load",main,!1):window.attachEvent&&(document.onreadystatechange=new function(){"complete"!==document.readyState&&"interactive"!==document.readyState||main()}),window.addEventListener("popstate",(function(e){console.log("popstate")})),window.addEventListener("hashchange",route);
</script>