<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>JSTMPL test</title>
<style>
    .red {
        color: red;
    }
</style>
<div id="app"></div>
<script>!function(e){"use strict";var r=document,n="prototype",f="update",t="appendChild",i="setAttribute",o="length",d="children",u="parent";function a(e,n,f){var i,u,a,c,p,s=this;for(i in s.puns=[],s.ref=r.createElement(e),s[d]=f,n)s.s(i,n[i]);if("string"===(p=typeof f))s.ref[t](r.createTextNode(f));else if("function"===p)u=r.createTextNode(""),s.ref[t](u),s.puns.push({fn:f,node:u});else if("object"===p)for(a=f[o],c=0;c<a;c++)s.ref[t](f[c].ref)}function c(e,r,n){var f=this;f[u]=e,f.appended=!1,f.ref=e.ref,f.cond=r,f.child=n,f.ref=e.ref}function p(e,r,n){var f=this;f.old=[],f[d]=[],f[u]=e,f.arrFn=r,f.factory=n,f.ref=e.ref}function s(e,r,n){return new a(e,r,n)}function l(e,r,n){return new c(e,r,n)}function h(e,r,n){return new p(e,r,n)}a[n].s=function(e,n){var f,t,o=this;if("ev"!==e){if("function"==typeof n)return t=r.createAttribute(e),o.puns.push({fn:n,node:t}),void o.ref[i+"Node"](t);o.ref[i](e,n)}else for(f in n)o.ref.addEventListener(f,n[f],!1)},a[n][f]=function(e){var r,n,t,u=this,a=0,c=u.puns[o];for(a=0;a<c;a++){if(r=(n=u.puns[a]).node,t=n.fn(e),n.old===t)return;"object"==typeof r?"INPUT"===u.ref.tagName&&"value"===r.name&&u.ref.value!==t?u.ref.value=t:r.nodeValue=t:u.ref[i](r,t),n.old=t}if("object"==typeof u[d])for(a in u[d])u[d][a][f](e)},c[n][f]=function(e){var r=this,n=r.cond(e);r[u][f](e),n&&r.child[f](e),r.appended&&!n?(r[u].ref.removeChild(r.child.ref),r.appended=!1):n&&(r[u].ref[t](r.child.ref),r.appended=!0)},p[n][f]=function(e){var r,n,i,a,c,p=this,s=p.arrFn(e),l=s[o];for(p[u][f](e),i=0;i<l;i++)n=s[i],p.old[i]!==n&&(p[d][i]?p[d][i][f]({index:i,item:n,parent:e}):((r=p.factory())[f]({index:i,item:n,parent:e}),p[d].push(r),p[u].ref[t](r.ref)));if((a=p.old[o])>(c=s[o]))for(i=a-c,p[d].splice(c);i--;)p[u].ref.removeChild(p[u].ref[d][c]);p.old=s.slice()},e&&(e.h=s,e.hIf=l,e.hFor=h)}(window);var Model={state:{clicks:0,error:"",className:"",show:!0,input:"",itemInputs:[1,2,3,4,5],items:[1,2,3,4,5]}};function main(){var e={clicks:0,error:"",className:"",show:!0,input:"",itemInputs:[],items:[]},t=e;function n(){console.log("loading model"),t=JSON.parse(window.localStorage.getItem("model"))||e,d()}function i(e){var n;console.log("removing item "+e.target.getAttribute("data-index")),t.items.splice(n=1*e.target.getAttribute("data-index"),1),t.itemInputs.splice(n),d()}function o(e){var n=e.target.getAttribute("data-index");t.itemInputs[n]=e.target.value}function a(e){var n=e.target.getAttribute("data-index");t.items[n]=t.itemInputs[n],t.itemInputs[n]="",d()}function s(){window.localStorage&&window.localStorage.setItem("model",JSON.stringify(t))}setTimeout(n,0);var u=!1;function r(e){return function(t){return t[e]}}window.addEventListener("hashchange",(function(){t.show=!t.show,console.log(t.show),d()})),window.addEventListener("storage",n);var c=h("div",{"class":"ahoj"},[h("h1",{"class":r("className"),ev:{click:function(e){t.className="red"===t.className?"":"red",d()}}},"Ahoj"),h("div",u,[h("p",u,r("clicks"))]),h("span",u,r("error")),h("a",{href:"#prdel",ev:{click:function(e){}}},"link1"),h("hr"),h("button",{ev:{mouseup:function(e){t.clicks++,t.clicks>0&&(t.error="",t.show=!0),d()}}},"   +   "),h("i",u," "),h("button",{ev:{mouseup:function(e){t.clicks--,t.clicks<0&&(t.error="Fok You!",t.show=!1),d()}}},"   -   "),hIf(h("h2",u,"Ahoj"),r("error"),h("span",u,r("error"))),hIf(h("div"),r("show"),h("div",u,[h("div",u,[h("div",u,[h("h1",u,"Ahoj")]),h("div",u,[h("h2",u,"Dalsi ahoj")])])])),hFor(h("ul"),r("items"),(function(){return h("li",u,[h("span",u,r("item")),h("span",u," "),h("input",{value:r("item"),"data-index":r("index"),ev:{change:o}}),h("button",{"data-index":r("index"),ev:{click:a}},"edit"),h("button",{"data-index":r("index"),ev:{mouseup:i}}," X ")])})),h("input",{value:r("input"),ev:{change:function(e){t.input=e.target.value}}}),h("button",{ev:{mouseup:function(e){t.items.push(t.input),t.itemInputs.push(t.input),t.input="",d()}}},"add Item")]);function d(e){setTimeout(s,0),c.update(e||t)}c.update(t);var l=document.getElementById("app");l.innerHTML="",l.appendChild(c.ref)}function route(e){console.log("hashchange")}window.addEventListener?window.addEventListener("load",main,!1):window.attachEvent&&(document.onreadystatechange=new function(){"complete"!==document.readyState&&"interactive"!==document.readyState||main()}),window.addEventListener("popstate",(function(e){console.log("popstate")})),window.addEventListener("hashchange",route);</script>