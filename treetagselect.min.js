function queryTree(e,n){setTimeout(n,500,{name:"world",expanded:!1,children:{232:{name:"FFF",expanded:!1,children:{1223:{name:"ad"},fafsd:{name:"jesdfdfenik"}}},wqe:{name:"Zlin",expanded:!1,children:{ccvd:{name:"Praha"}}}}})}function ajaxGetChildren(e,n){setTimeout(n,500,e,{1111:{name:"111"},2222:{name:"222"},3333:{name:"333"}})}function flatten(e,n,t,d){e.push({name:t.name,expanded:"expanded"in t?t.expanded?1:-1:0,id:n,depth:d}),t.children&&Object.keys(t.children).forEach((function(n){flatten(e,n,t.children[n],d+1)}))}function findNodeById(e,n,t){return n.id===t?(e.node=n,!0):"children"in n&&(Object.keys(n.children).indexOf(t)>-1?(e.node=n.children[t],!0):Object.keys(n.children).some((function(d){return findNodeById(e,n.children[d],t)})))}function main(){var e,n,t={inputRef:null,loading:!1,selected:[],selectedIds:{},serverResponse:{name:"world",expanded:!1,children:{12393030:{name:"Olomoucky kraj",expanded:!1,children:{123123:{name:"Olomouc"},3422:{name:"jesenik"}}},3121313123:{name:"Zlinsky kraj",expanded:!1,children:{1312313:{name:"Zlin"}}}}},flattenedResponse:[{id:"12393030",name:"Olomoucky kraj",expanded:!1,loading:!1,depth:0},{id:"123123",name:"Olomouc",expanded:!1,loading:!1,depth:1},{id:"1232131",name:"Jesenik",expanded:!1,loading:!1,depth:1}]},d=!1;function a(e){console.log("updating"),t.serverResponse=e,t.flattenedResponse=[],flatten(t.flattenedResponse,"__root__",e,0),t.loading=!1,p()}function i(e){n.ref.innerText=e,input.ref.style.width=n.ref.clientWidth+1+"px"}function r(){e.ref.style.display="none"}function o(e){var n=e.target.checked,d=e.target.getAttribute("data-id"),a=e.target.getAttribute("data-name");n?(t.selected.push({id:d,name:a}),t.selectedIds[d]=!0):(t.selected=t.selected.filter((function(e){return e.id!==d})),delete t.selectedIds[d]),p()}function s(e){var n=e.target.getAttribute("data-id");t.selected=t.selected.filter((function(e){return e.id!==n})),delete t.selectedIds[n],p()}function c(e,n){var d={};findNodeById(d,t.serverResponse,e)&&(assignDeep(d.node.children,n),d.node.expanded=!0,d.node.loading=!1,t.flattenedResponse=[],flatten(t.flattenedResponse,"__root__",t.serverResponse,0),p())}function l(e){var n=e.target.checked,d=e.target.getAttribute("data-id");if(n)ajaxGetChildren(d,c),t.flattenedResponse.some((function(e){return e.id===d&&(e.loading=!0,!0)})),p();else{var a={};findNodeById(a,t.serverResponse,d),a.node.children={},a.node.expanded=!1,t.flattenedResponse=[],flatten(t.flattenedResponse,"__root__",t.serverResponse,0),p()}}function u(e){return function(n){return n[e]}}var f=h("div",{"class":"treetagselect"},[n=h("div",{"class":"treetagselect_hiddenmirror"}),h("div",{"class":"treetagselect_inputcontainer",ev:{mousedown:function(e){input.ref.focus(),e.preventDefault(),e.stopPropagation()}}},[hFor(h("ul",{"class":"treetagselect_selectedtags"}),u("selected"),(function(){return h("li",{"class":"treetagselect_tag"},[h("span",d,(function(e){return e.item.name})),h("button",{"class":"treetagselect_tag_button","data-id":function(e){return e.item.id},ev:{click:s}},"X")])})),input=h("input",{"class":"treetagselect_input",tabindex:"0",ev:{input:function(n){var d=n.target.value;i(d),d.length>3&&(queryTree(n.target.value,a),e.ref.style.display="block",t.loading=!0,p())},focus:function(){input.ref.value.length>3&&(e.ref.style.display="block",console.log(e.ref.style.display))}}}),h("button",{"class":"treetagselect_clearbtn",ev:{click:function(){t.inputRef.value="",i(""),t.flattenedResponse=[],r(),p()}}},"X")]),hIf(h("div"),(function(e){return e.loading}),h("span",d,"loading")),hFor(e=h("ul",{"class":"treetagselect_results"}),u("flattenedResponse"),(function(){return h("li",d,[h("span",d,(function(e){for(var n="",t=e.item.depth,d=0;d<t;d++)n+="   ";return n})),hIf(h("span"),(function(e){return 0!==e.item.expanded}),h("span",d,[h("input",{type:"checkbox","data-id":function(e){return e.item.id},checked:function(e){return 1===e.item.expanded},ev:{change:l}}),h("label",d,(function(e){return e.item.loading?"loading":""}))])),h("input",{type:"checkbox",id:function(e){return e.item.id},"data-id":function(e){return e.item.id},"data-name":function(e){return e.item.name},checked:function(e){return e.item.selected},ev:{change:o}}),h("label",{"for":function(e){return e.item.id}},(function(e){return e.item.name}))])}))]);function p(e){t.flattenedResponse.forEach((function(e){e.selected=e.id in t.selectedIds})),f.update(e||t)}e.ref.addEventListener("mousedown",(function(e){e.stopPropagation()})),window.addEventListener("mousedown",r),t.inputRef=input.ref,t.flattenedResponse=[],flatten(t.flattenedResponse,"__root__",t.serverResponse,0),p();var m=document.getElementById("app");m.innerHTML="",m.appendChild(f.ref)}window.addEventListener?window.addEventListener("load",main,!1):window.attachEvent&&(document.onreadystatechange=new function(){"complete"!==document.readyState&&"interactive"!==document.readyState||main()});