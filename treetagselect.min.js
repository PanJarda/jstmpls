function queryTree(e,n){setTimeout(n,500,{name:"world",expanded:!1,children:{232:{name:"FFF",expanded:!1,children:{1223:{name:"ad"},fafsd:{name:"jesdfdfenik"}}},wqe:{name:"Zlin",expanded:!1,children:{ccvd:{name:"Praha"}}}}})}function ajaxGetChildren(e,n){setTimeout(n,500,e,{1111:{name:"111"},2222:{name:"222"},3333:{name:"333"}})}function flatten(e,n,t,a){e.push({name:t.name,expanded:"expanded"in t?t.expanded?1:-1:0,id:n,depth:a}),t.children&&Object.keys(t.children).forEach((function(n){flatten(e,n,t.children[n],a+1)}))}function findNodeById(e,n,t){return n.id===t?(e.node=n,!0):"children"in n&&(Object.keys(n.children).indexOf(t)>-1?(e.node=n.children[t],!0):Object.keys(n.children).some((function(a){return findNodeById(e,n.children[a],t)})))}function main(){var e,n,t,a,d={inputRef:null,loading:!1,selected:[],selectedIds:{},serverResponse:{id:"__root__",name:"world",expanded:!1,children:{12393030:{name:"Olomoucky kraj",expanded:!1,children:{123123:{name:"Olomouc"},3422:{name:"jesenik"}}},3121313123:{name:"Zlinsky kraj",expanded:!1,children:{1312313:{name:"Zlin"}}}}},flattenedResponse:[{id:"12393030",name:"Olomoucky kraj",expanded:!1,loading:!1,depth:0},{id:"123123",name:"Olomouc",expanded:!1,loading:!1,depth:1},{id:"1232131",name:"Jesenik",expanded:!1,loading:!1,depth:1}]},i=!1;function r(n){d.serverResponse=n,d.flattenedResponse=[],flatten(d.flattenedResponse,"__root__",n,0),e.ref.style.display="block",d.loading=!1,m()}function s(e){n.ref.innerText=e,input.ref.style.width=n.ref.clientWidth+1+"px"}function o(e){var n=e.target.checked,t=e.target.getAttribute("data-id"),a=e.target.getAttribute("data-name");n?(d.selected.push({id:t,name:a}),d.selectedIds[t]=!0):(d.selected=d.selected.filter((function(e){return e.id!==t})),delete d.selectedIds[t]),input.ref.focus(),m()}function l(e){var n=e.target.getAttribute("data-id");d.selected=d.selected.filter((function(e){return e.id!==n})),delete d.selectedIds[n],m()}function c(e,n){var t={};findNodeById(t,d.serverResponse,e)&&(assignDeep(t.node.children,n),t.node.expanded=!0,t.node.loading=!1,d.flattenedResponse=[],flatten(d.flattenedResponse,"__root__",d.serverResponse,0),m())}function u(e){var n=e.target.checked,t=e.target.getAttribute("data-id");if(n)ajaxGetChildren(t,c),d.flattenedResponse.some((function(e){return e.id===t&&(e.loading=!0,!0)})),m();else{var a={};findNodeById(a,d.serverResponse,t),a.node.children={},a.node.expanded=!1,d.flattenedResponse=[],flatten(d.flattenedResponse,"__root__",d.serverResponse,0),m()}}function f(e){return function(n){return n[e]}}var p=h("div",{"class":"treetagselect"},[n=h("div",{"class":"treetagselect_hiddenmirror"}),a=h("div",{"class":"treetagselect_inputcontainer",ev:{mousedown:function(e){input.ref.focus(),t.ref.style.display="none",e.preventDefault(),e.stopPropagation()}}},[hFor(h("ul",{"class":"treetagselect_selectedtags"}),f("selected"),(function(){return h("li",{"class":"treetagselect_tag"},[h("span",i,(function(e){return e.item.name})),h("button",{"class":"treetagselect_tag_button","data-id":function(e){return e.item.id},ev:{click:l}},"X")])})),input=h("input",{"class":"treetagselect_input",tabindex:"0",ev:{input:function(e){var n=e.target.value;s(n),n.length>1&&(a.ref.classList.add("show_results"),queryTree(e.target.value,r),d.loading=!0,d.flattenedResponse=[],m())},focus:function(){input.ref.value.length>3&&(e.ref.style.display="block",console.log(e.ref.style.display))}}}),t=h("span",{"class":"treetagselect_placeholder"},"Select admin levels")]),hIf(h("div"),(function(e){return e.loading}),h("span",i,"loading")),hFor(e=h("ul",{"class":"treetagselect_results"}),f("flattenedResponse"),(function(){return h("li",i,[h("span",i,(function(e){for(var n="",t=e.item.depth,a=0;a<t;a++)n+="   ";return n})),hIf(h("span"),(function(e){return 0!==e.item.expanded}),h("span",i,[h("input",{type:"checkbox","class":"treetagselect_expand_toggle",id:function(e){return e.item.id+"-expand"},"data-id":function(e){return e.item.id},checked:function(e){return 1===e.item.expanded},ev:{change:u}}),h("label",{"class":"treetagselect_rightarrow_container","for":function(e){return e.item.id+"-expand"}},[h("span",{"class":"treetagselect_rightarrow"})]),h("label",{"class":"treetagselect_downarrow_container","for":function(e){return e.item.id+"-expand"}},[h("span",{"class":"treetagselect_downarrow"})]),h("label",i,(function(e){return e.item.loading?"loading":""}))])),h("input",{type:"checkbox",id:function(e){return e.item.id},"data-id":function(e){return e.item.id},"data-name":function(e){return e.item.name},checked:function(e){return e.item.selected},ev:{change:o}}),h("label",{"for":function(e){return e.item.id}},(function(e){return e.item.name}))])}))]);function m(e){d.flattenedResponse.forEach((function(e){e.selected=e.id in d.selectedIds})),p.update(e||d)}e.ref.addEventListener("mousedown",(function(e){e.stopPropagation()})),window.addEventListener("mousedown",(function(){var n;e.ref.style.display="none",a.ref.classList.remove("show_results"),d.inputRef.value="",s(""),d.selected.length||(t.ref.style.display="inline"),d.flattenedResponse=[],m(),n&&n.stopPropagation()})),d.inputRef=input.ref,d.flattenedResponse=[],flatten(d.flattenedResponse,"__root__",d.serverResponse,0),m();var g=document.getElementById("app");g.innerHTML="",g.appendChild(p.ref)}window.addEventListener?window.addEventListener("load",main,!1):window.attachEvent&&(document.onreadystatechange=new function(){"complete"!==document.readyState&&"interactive"!==document.readyState||main()});